<% layout("layouts/boilerplate.ejs") -%>

<script>
  const explore = <%- JSON.stringify(explore) %>
</script>

<body>
  <div class="show-card">
    <div class="show-card-bg"></div>
    <div class="Data">
      <h3 class="Heading"><%= explore.title %></h3>
      <p class="Info"><%= explore.info %></p>
    </div>
    <div id="carouselExample" class="carousel slide carousel-fade">
      <div class="carousel-inner">
        <div class="carousel-item active">
          <img src="<%= explore.image.url1 %>" class="Image" alt="..." />
        </div>
        <div class="carousel-item">
          <img src="<%= explore.image.url2 %>" class="Image" alt="..." />
        </div>
        <div class="carousel-item">
          <img src="<%= explore.image.url3 %>" class="Image" alt="..." />
        </div>
        <div class="carousel-item">
          <img src="<%= explore.image.url4 %>" class="Image" alt="..." />
        </div>
        <div class="carousel-item">
          <img src="<%= explore.image.url5 %>" class="Image" alt="..." />
        </div>
      </div>
      <button
        class="carousel-control-prev"
        type="button"
        data-bs-target="#carouselExample"
        data-bs-slide="prev"
      >
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </button>
      <button
        class="carousel-control-next"
        type="button"
        data-bs-target="#carouselExample"
        data-bs-slide="next"
      >
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </button>
    </div>
  </div>
  <hr class="space-line" />
  <div class="extraData">
    <h4>Overview</h4>
    <p class="card-text overInfo"><%= explore.overview %></p>
    <p class="card-text"><%= explore.description %></p>
    <h4>Famous for</h4>
    <p class="card-text"><%= explore.famous %></p>
    <h4>Best time to visit</h4>
    <p class="card-text"><%= explore.visitTime %></p>
    <h4>Places near by</h4>
    <p class="card-text place">
      <b><%= explore.place1.title %></b>: &nbsp;<%= explore.place1.description%>
    </p>
    <p class="card-text">
      <b><%= explore.place2.title %></b>: &nbsp;<%= explore.place2.description%>
    </p>
    <p class="card-text">
      <b><%= explore.place3.title %></b>: &nbsp;<%= explore.place3.description%>
    </p>

    <% if (currUser && explore.owner && currUser._id.equals(explore.owner._id ||
    explore.owner)) { %>
    <div class="mb-3">
      <h4>Edit and Delete</h4>
      <div class="btns mt-4">
        <form method="get" action="/explore/<%= explore._id %>/edit">
          <button type="submit" class="btn btn-success button">
            <i class="fa-solid fa-file-pen"></i>
            Edit
          </button>
        </form>
        <form method="post" action="/explore/<%= explore._id %>?_method=DELETE">
          <button type="submit" class="btn btn-danger">
            <i class="fa-solid fa-trash"></i>
            Delete
          </button>
        </form>
      </div>
    </div>
    <% } %>

    <!-- Reviews-->

    <% if(currUser) { %>
    <h4>Leave a Review</h4>
    <div class="col-6 mt-3">
      <form method="post" action="/explore/<%= explore._id%>/reviews">
        <fieldset class="starability-slot" required>
          <legend>Rating:</legend>
          <input
            type="radio"
            id="no-rate-<%= explore._id %>"
            class="input-no-rate"
            name="review[rating]"
            value=""
            checked
            aria-label="No rating."
          />
          <input
            type="radio"
            id="first-rate1-<%= explore._id %>"
            name="review[rating]"
            value="1"
          />
          <label for="first-rate1-<%= explore._id %>" title="Terrible"
            >1 star</label
          >
          <input
            type="radio"
            id="first-rate2-<%= explore._id %>"
            name="review[rating]"
            value="2"
          />
          <label for="first-rate2-<%= explore._id %>" title="Not good"
            >2 stars</label
          >
          <input
            type="radio"
            id="first-rate3-<%= explore._id %>"
            name="review[rating]"
            value="3"
          />
          <label for="first-rate3-<%= explore._id %>" title="Average"
            >3 stars</label
          >
          <input
            type="radio"
            id="first-rate4-<%= explore._id %>"
            name="review[rating]"
            value="4"
          />
          <label for="first-rate4-<%= explore._id %>" title="Very good"
            >4 stars</label
          >
          <input
            type="radio"
            id="first-rate5-<%= explore._id %>"
            name="review[rating]"
            value="5"
          />
          <label for="first-rate5-<%= explore._id %>" title="Amazing"
            >5 stars</label
          >
        </fieldset>
        <br />
        <label for="comment" class="form-label">Comment</label><br />
        <input
          type="text"
          name="review[comment]"
          placeholder="write a review..."
          class="form-control"
          required
        /><br />
        <button type="submit" class="btn btn-success button">Add review</button>
      </form>
    </div>
    <%}%>

    <!--Showing all reviews-->
    <h4>Reviews</h4>
    <div class="review">
      <% if (reviews && reviews.length) { %> <% reviews.forEach(function(review)
      { %>
      <div class="review-card col-3 p-2 ps-3">
        <% if (review.author) { %>
        <p>@<%= review.author.username %></p>
        <% } %>
        <p><%= review.comment %></p>
        <p class="starability-result" data-rating="<%= review.rating %>"></p>
        <small><%= new Date(review.createdAt).toLocaleString() %></small>

        <% if (currUser && review.author &&
        currUser._id.equals(review.author._id)) { %>
        <div class="btns">
          <form
            class="mt-3"
            method="get"
            action="/explore/<%= explore._id %>/reviews/<%=review._id%>/edit"
          >
            <button type="submit" class="btn btn-success button">Edit</button>
          </form>
          <form
            class="mt-3"
            method="post"
            action="/explore/<%= explore._id %>/reviews/<%=review._id%>?_method=DELETE"
          >
            <button type="submit" class="btn btn-danger button">Delete</button>
          </form>
        </div>
        <% } %>
      </div>
      <% }) %> <% } else { %>
      <p>No reviews yet â€” be the first to review!</p>
      <% } %>
    </div>
  </div>
</body>
